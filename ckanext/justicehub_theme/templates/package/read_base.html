{% ckan_extends %}

{% set organization=c.group_dict %}

{% block wrapper_class %}
	no-nav
{% endblock %}

{% block pre_primary %}
<div class="col-xs-12 row top-section">
    <div class="col-sm-7 col-xs-12">
        <div class="row">
            <h1>{{h.dataset_display_name(pkg)}}
            {% if pkg.private %}
                <i style="margin-left: 10px;" class="fa fa-lock fa-lg"></i>
            {% endif %}
            {% if pkg.verified %}
                <i style="margin-left: 10px;" class="fa fa-check fa-lg"></i>
            {% endif %}
            </h1>
            <p class="package-desc"> {{h.get_translated(pkg, 'notes')}}</p>
        </div>

        <div class="row">
            {% for tag in pkg.tags %}
            <div class="pkg_tags">
                <a href="{% url_for controller='package', action='search', tags=tag.name %}">{{ h.truncate(tag.display_name, 22) }}</a>
            </div>
            {% endfor %}
        </div>
        <div class="row meta-desc">
            <a href="{{ pkg.license_url }}">{{ pkg.license_title }}</a>
        </div>
        <div class="row stats-box">
            <div class="col-xs-6 col-sm-4">
                <span class="stats">{{ h.justicehub_theme_get_package_avg_downloads(pkg) }}{{ _('+') }}</span>
                <span class="stats-text">{{ _('DOWNLOADS') }}</span>
            </div>
            <div class="col-xs-6 col-sm-4">
                <span class="stats">{{ pkg.tracking_summary.total }}{{ _('+') }}</span>
                <span class="stats-text">{{ _('VIEWS') }}</span>
            </div>
        </div>

        {% if self.content_action() | trim %}
        <div class="row content_action pull-left">
            {% block content_action %}
            {% if h.check_access('package_update', {'id':pkg.id }) %}
            {% link_for _('EDIT'), controller='package', action='edit', id=pkg.name, class_='btn btn-default' %}
            {% endif %}
            {% endblock %}
        </div>
        {% endif %}
    </div>
    <div class="col-sm-1">
    </div>
    <div class="col-sm-4 col-xs-12">
        <div class="row org-box image-box">
        <a href="{{ h.url_for(controller='organization', action='read', id=pkg.organization.id) }}">
        {% set image_path = h.url_for_static('uploads/group/' + pkg.organization.image_url, qualified=True) %}
        <img src="{{ image_path or h.url_for_static('/base/images/placeholder-organization.png') }}" alt="{{ pkg.organization.name }}" class="img-responsive media-image" >
        {{ c.group_dict.display_name }}
        </a>
        </div>
        <div class="row">
            <div class="col col-md-12 partner-links social-links">
            <ul class="list-unstyled list-inline">
                <li>
                    <a href="{{ pkg.partner.website }}"
                       aria-hidden="true" alt="{{ pkg.organization.name }}'s Website"
                       role="link" title="Official Website"
                       aria-label="{{ pkg.organization.name }}'s Website"
                       target="_blank">
                        <i class="fa fa-link fa-lg"></i>
                    </a>
                </li>
                <li>
                    <a href="{{ pkg.partner.email }}"
                       aria-hidden="true" alt="{{ pkg.organization.name }}'s Email Address"
                       role="link" title="Email Address"
                       aria-label="{{ pkg.organization.name }}'s Email Address"
                       target="_blank">
                    <i class="fa fa-envelope fa-lg"></i>
                    </a>
                </li>
                <li>
                    <a href="{{ pkg.partner.twitter }}"
                       aria-hidden="true" alt="{{ pkg.organization.name }}'s Twitter Handle"
                       role="link" title="Official Twitter Handle"
                       aria-label="{{ pkg.organization.name }}'s Twitter Handle"
                       target="_blank">
                        <i class="fa fa-twitter fa-lg"></i>
                    </a>
                </li>
                <li>
                    <a href="{{ pkg.partner.twitter }}"
                       aria-hidden="true" alt="{{ pkg.organization.name }}'s Facebook Page"
                       role="link" title="Official Facebook Page"
                       aria-label="{{ pkg.organization.name }}'s Facebook Page"
                       target="_blank">
                        <i class="fa fa-facebook fa-lg"></i>
                    </a>
                </li>
            </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<div class="col-xs-12 row">
    {% block secondary %}
    <aside class="secondary col-sm-3 col-xs-12 pckg_rsrc_actvty">
        <h2>ACTIVITY</h2>
        {% block activity_stream %}
        <div class="activity-item">{{ h.justicehub_theme_package_activity_stream(pkg.id) }}</div>
        {% endblock %}
    </aside>
    {% endblock %}

    {% block primary %}
    <div class="primary col-sm-9 col-xs-12">
        {% block primary_content %}
        {{ super() }}
        {% endblock %}
    </div>

    {% if pkg.links %}
    {% set links = h.justicehub_theme_parse_json(pkg.links) %}
    <div class="col-xs-12 row page-section">
        <div class="col col-sm-9 col-xs-12 pull-right">
        <h1 class="heading">{{ _('EXTERNAL LINKS') }}</h1>
        {% for item in links %}
           <ul class="list-unstyled links-list list-inline">
          {% set item = h.composite_get_as_dict(item) %}
          <li>
              <a href="{{ link }}">{{ item['title'] }}</a>
          </li>
          <li class="pull-right">
              <p>{{ item['description'] }}</p>
          </li>
          </ul>
        {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class= "col-xs-12 row page-section">
        <div class="col col-sm-9 col-xs-12 pull-right">
            {% block package_additional_info %}
            {% snippet "package/snippets/additional_info.html", pkg_dict=pkg %}
            {% endblock %}
        </div>

    {% endblock %}
</div>

{% block page_header %}
<div class="row package-tabs">
    <ul class="nav nav-tabs">
        {% block content_primary_nav %}
        {{ h.build_nav_icon('dataset_read', _('FILES'), id=pkg.name) }}
        {% if h.issues_enabled(pkg) %}
        {{ h.build_nav_icon('issues_dataset', _('ISSUES'), dataset_id=pkg.name) }}
        {% endif %}
        {% endblock %}
    </ul>
</div>
{% endblock %}
