{% ckan_extends %}

{% block resource_inner %}
    <div class="module-content res-top-content">

    {% block resource_content %}

        {% block resource_read_title %}
            <h1>{{ h.resource_display_name(res) | truncate(50) }}</h1>
        {% endblock %}

        <div class="prose notes resource-desc" property="rdfs:label">
            {% if res.description %}
              {{ h.render_markdown(res.description) }}
            {% endif %}
            {% if not res.description and c.package.notes %}
              <h3>{{ _('From the dataset abstract') }}</h3>
              <blockquote>{{ h.markdown_extract(h.get_translated(c.package, 'notes')) }}</blockquote>
              <p class="res-title">{% trans dataset=c.package.title, url=h.url_for(controller='package', action='read', id=c.package['name']) %}Source: <a class="res-url-src" href="{{ url }}">{{ dataset }}</a>{% endtrans %}
            {% endif %}
        </div>

        <div class="res-line-margin-bottom meta-desc">
            <a href="{{ pkg.license_url }}">{{ pkg.license_title }}</a>
        </div>

        {% block resource_read_url %}
            {% if res.url and h.is_url(res.url) %}
              <p class="text-muted ellipsis res-title meta-desc">{{ _('URL:') }} <a class="resource-url-analytics res-url-src" href="{{ res.url }}" title="{{ res.url }}">{{ res.url }}</a></p>
            {% elif res.url %}
              <p class="text-muted break-word res-title meta-desc">{{ _('URL:') }} {{ res.url }}</p>
            {% endif %}
        {% endblock %}

		<div class="actions res-actions">
		  {% block resource_actions %}
		  <ul>
		  {% block resource_actions_inner %}
		    {% if h.check_access('package_update', {'id':pkg.id }) %}
		        {% link_for _('EDIT'), controller='package', action='resource_edit', id=pkg.name, resource_id=res.id, class_='btn btn-default btn-action' %}
		    {% endif %}

		    {% if res.url and h.is_url(res.url) %}
		      <li>
		        <div class="btn-group">
		        <a class="btn btn-primary btn-action resource-url-analytics resource-type-{{ res.resource_type }}" href="{{ res.url }}">
		          {% if res.resource_type in ('listing', 'service') %}
                      {{ _('VIEW') }}
		          {% elif  res.resource_type == 'api' %}
                      {{ _('API ENDPOINT') }}
		          {% elif (not res.has_views or not res.can_be_previewed) and not res.url_type == 'upload' %}
                      {{ _('Go to resource') }}
		          {% else %}
                      {{ _('DOWNLOAD') }}
		          {% endif %}
		        </a>

		        {% block download_resource_button %}
                    {{ super() }}
                {% endblock %}
		        </div>
		      </li>
		    {% endif %}
		  {% endblock %}
		  </ul>
		  {% endblock %}
		</div>
    {% endblock %}

    {% if res.format == 'CSV' %}
        {% block data_preview %}
        {{ super() }}
        {% endblock %}
    {% endif %}
{% endblock %}

{% block primary_content %}
  <div class="col-sm-9 col-xs-12">
  {% block resource_additional_information %}
  {% if res %}
      <section class="module">
          <h1 class="page-heading">{{ _('ADDITIONAL INFORMATION') }}</h2>
          {% block resource_additional_information_inner %}
          <div class="module-content">
          <table class="table table-striped table-bordered table-condensed" data-module="table-toggle-more">
            <thead>
              <tr>
                <th scope="col">{{ _('Field') }}</th>
                <th scope="col">{{ _('Value') }}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td scope="row">{{ _('Data last updated') }}</th>
                <td>{{ h.render_datetime(res.last_modified) or h.render_datetime(res.created) or _('unknown') }}</td>
              </tr>
              <tr>
                <td scope="row">{{ _('Metadata last updated') }}</th>
                <td>{{ h.render_datetime(res.revision_timestamp) or h.render_datetime(res.created) or _('unknown') }}</td>
              </tr>
              <tr>
                <td scope="row">{{ _('Created') }}</th>
                <td>{{ h.render_datetime(res.created) or _('unknown') }}</td>
              </tr>
              <tr>
                <td scope="row">{{ _('Format') }}</th>
                <td>{{ res.mimetype_inner or res.mimetype or res.format or _('unknown') }}</td>
              </tr>
              <tr>
                <td scope="row">{{ _('License') }}</th>
                <td>{% snippet "snippets/license.html", pkg_dict=pkg, text_only=True %}</td>
              </tr>
              {% for key, value in h.format_resource_items(res.items()) %}
                <tr class="toggle-more"><td scope="row">{{ key }}</th><td>{{ value }}</td></tr>
              {% endfor %}
            </tbody>
          </table>
          </div>
          {% endblock %}
      </section>
  {% endif %}
  {% endblock %}
  </div>

  <div class="col-sm-3  col-xs-12 res-social">
    {% snippet "snippets/social.html" %}
  </div>
{% endblock %}

{% block secondary_content %}

  {% block resources_list %}
    {% snippet "package/snippets/resources.html", pkg=pkg, active=res.id %}
  {% endblock %}

{% endblock %}

